"use strict";uBlock.restart=function(){var a,e=uBlock,t=864e5,n=["US","AU","GB","CA","FR","DE","NL","ES"],r=["NZ","JP","IT"];vAPI.app.onShutdown=function(){};var o=function(a,e){var t=null,n=new XMLHttpRequest;n.open("GET",a),n.onload=function(){t=n.response,localStorage.setItem(e,t)},n.send()},i=function(a,t){var n=new Date(a),r=(Date.now(),n.getTime(),{LastCallbackDate:n.toISOString(),SP:e.webCompanionData.searchEngine,Theme:t,extensionID:chrome.runtime.id});o("https://acs.lavasoft.com/malurl/api/urls/query/blacklist","ACS_black"),adawareTelemetry.sendEventTrackingInfo("DailyActivity",r)};function s(a,n){var r=(Date.now()+18250*t)/1e3;n&&(r=n),bitMask.getValue().then(t=>{var n={SE_provider:a,install_date:e.webCompanionData.iDate,partner_id:adawareTelemetry.getExternalData().PartnerID,browser_name:vAPI.browserShortName,bitmask:t};e.SEARCH_ENGINE_URL;var o=function(a,e,t,n,r){return{host:e,path:t,name:n,value:"object"==typeof a?JSON.stringify(a):a,isSecure:!1,isHttpOnly:!1,isSession:!1,expiry:r}}(n,"defaultsearch.co","/","search_companion",r);vAPI.setCookie(o)})}var l=function(a,e){return new Promise(function(t,n){adawareUtils.fetchWebCompanionData(function(e){var n=a(e);t(n)},function(){var a=e();n(a)},"http://localhost:9007/webcompanion/extension/ffnt/token")})},c=function(){!function(){var a;try{chrome.tabs.query({url:"http://*.adaware.com/*"},function(e){e.length>0&&(a=e[0],chrome.tabs.executeScript(a.id,{code:'localStorage.getItem("configuration");'},function(a){var e;e=JSON.parse(a[0]),chrome.storage.sync.set({config:e})}))})}catch(a){}}();var a=Date.now();adawareTelemetry.setInstallDate(a),vAPI.storage.set({installDate:a});var t=adawareUtils.generateUUID();adawareTelemetry.setInstallId(t),vAPI.storage.set({installId:t}),function(){function a(a){return new Promise(function(e,t){adawareUtils.httpGetAsync("http://ip-api.com/json",function(t){var o=JSON.parse(t).countryCode,i=a;n.indexOf(o)>-1?i.webCompanionData.searchEngine="1":r.indexOf(o)>-1?i.webCompanionData.searchEngine="1":i.webCompanionData.searchEngine="3",e(i)},function(e){t(a)},"application/json")})}function t(a){return new Promise(function(t,n){var r=a;vAPI.getCookie({url:"https://www.adaware.com/ext/",name:"inline"},function(n){var o=unescape(n);if(n){if("LV170101FF"===a.externalData.PartnerID){var i=JSON.parse(o).pid;i&&(r.externalData.PartnerID=i)}r.externalData.sourceTraffic="adaware/ext";var s={EXT:JSON.parse(o).ext||null,CTA:JSON.parse(o).cta||null,VN:JSON.parse(o).vn||null,SID:JSON.parse(o).sid||null};e.saveInlineParameters(s),t(r)}else t(r)})})}function i(a){return new Promise(function(t,n){var r=a;vAPI.getCookie({url:"https://www.adaware.com/wp/",name:"datainstallsource"},function(n){var o=unescape(n);if(n){if("LV170101FF"===a.externalData.PartnerID){var i=JSON.parse(o).pid;i&&(r.externalData.PartnerID=i)}r.externalData.sourceTraffic="WebProtectionTest";var s={EXT:JSON.parse(o).ext||null,CTA:JSON.parse(o).cta||null,VN:JSON.parse(o).vn||null,SID:JSON.parse(o).sid||null};e.saveInlineParameters(s),t(r)}else t(r)})})}function c(a){return new Promise(function(e,t){var n=a;chrome.storage.sync.get("config",function(a){a&&Object.keys(a).length>0&&null!==a.config?(n.externalData.sourceTraffic=a.config.bundleId,n.externalData.OfferID=a.config.offerId,n.externalData.CampaignID=a.config.campaignId):(n.externalData.sourceTraffic="",n.externalData.OfferID="",n.externalData.CampaignID=""),e(n)})})}function u(a){return new Promise(function(e,t){try{let n=a;chrome.tabs.query({url:"https://chrome.google.com/webstore/*"},a=>{if(a.length>0){let t=a[0].url,r={};decodeURIComponent(t.slice(t.indexOf("?")+1)).split("&").forEach((a,e)=>{let t=a.split("=",2);r[t[0]]=t[1]}),Object.keys(r).length>0&&(n.externalData.PartnerID=r.partnerID?r.partnerID:"",n.externalData.CampaignID=r.utm_campaign?r.utm_campaign:"",n.externalData.CLID=r.clid?r.clid:"",n.externalData.OfferID=r.offerid?r.offerid:"",n.externalData.sourceTraffic=r.sourceTraffic?r.sourceTraffic:""),e(n)}else e(n)})}catch(a){t(a)}})}o("https://acs.lavasoft.com/malurl/api/urls/query/blacklist","ACS_black"),l(function(a){var e=JSON.parse(JSON.parse(a)).data,t={CampaignID:e.campaignId||"",CLID:e.clid||"",PartnerID:e.PartnerID||"LV170101FF",sourceTraffic:e.bundleId||"",OfferID:e.offerId||""},n={searchEngine:"1",campaignId:e.campaignId||""};return e.PartnerID&&e.PartnerID.endsWith("_sh")&&(t.PartnerID=e.pid.replace("_sh","")),{trackingData:{},externalData:t,webCompanionData:n}},function(){return{trackingData:{},externalData:{CampaignID:"",CLID:"",PartnerID:adawareTelemetry.getExternalData().PartnerID||"LV170101FF",sourceTraffic:"",OfferID:""},webCompanionData:{searchEngine:"1",campaignId:""}}}).then(a,a).then(t,t).then(function(a){return new Promise(function(e,t){var n=a;"LV170101FF"===a.externalData.PartnerID?(n.externalData.sourceTraffic="adaware",vAPI.getCookie({url:"https://www.adaware.com/",name:"config"},function(a){if(null!==a){var t=JSON.parse(a).Partner;t&&(n.externalData.PartnerID=t)}else n.externalData.PartnerID="";e(n)})):e(n)})}).then(i,i).then(c,c).then(u,u).then(function(a){adawareTelemetry.setExternalData(a.externalData),e.saveExternalData(),e.webCompanionData=a.webCompanionData,vAPI.storage.set({webCompanionData:e.webCompanionData}),s(e.NUM_TO_SEARCH_MAP[a.webCompanionData.searchEngine]),adawareTelemetry.sendEventTrackingInfo("CompleteInstall",a.trackingData),adawareTelemetry.setupUninstall()})}();var i={host:"www.adaware.com",name:"ssext",value:"installed",path:"/",isSecure:!1,isHttpOnly:!1,expiry:(Date.now()+3e5)/1e3};vAPI.setCookie(i)},u=function(a){new Promise(function(a,e){vAPI.storage.get({installDate:Date.now(),installId:adawareUtils.generateUUID()},function(e){adawareTelemetry.setInstallDate(e.installDate),adawareTelemetry.setInstallId(e.installId),a()})}).then(function(){!function(){function a(a){adawareTelemetry.setExternalData(a.externalData),e.saveExternalData(),s(e.NUM_TO_SEARCH_MAP[e.webCompanionData.searchEngine]),a.webCompanionData&&(e.webCompanionData=a.webCompanionData,vAPI.storage.set({webCompanionData:e.webCompanionData})),adawareTelemetry.sendEventTrackingInfo("CompleteUpdate",a.trackingData),adawareTelemetry.setupUninstall()}l(function(a){var t=JSON.parse(JSON.parse(a)).data,n={CampaignID:t.campaignId,CLID:t.clid,PartnerID:t.pid||"LV170101FF"};return"LV170101FF"===n.PartnerID&&e.webCompanionData.pid&&(n.PartnerID=e.webCompanionData.pid),{trackingData:{},externalData:n,webCompanionData:e.webCompanionData}},function(){var a={CampaignID:"",CLID:"",PartnerID:adawareTelemetry.getExternalData().PartnerID||"LV170101FF"};return"LV170101FF"===a.PartnerID&&e.webCompanionData.pid&&(a.PartnerID=e.webCompanionData.pid),{trackingData:{},externalData:a}}).then(a,a)}()})},D=function(a){var n=[];n.push(new Promise(function(a,e){vAPI.storage.get({externalData:adawareTelemetry.getExternalData()},function(e){adawareTelemetry.setExternalData(e.externalData),a("externalData")})})),n.push(new Promise(function(a,t){vAPI.storage.get({webCompanionData:e.webCompanionData},function(t){e.webCompanionData=t.webCompanionData,a("webCompanionData")})})),Promise.all(n).then(function(n){if("install"===a.reason){c();try{chrome.tabs.query({url:"https://chrome.google.com/webstore/detail/*"},function(a){if(a.length>0){var e=a[0].url.split("?")[1];chrome.tabs.create({url:"https://media.adaware.com/securesearch/lp/thankyou.php?"+e})}})}catch(a){}}else"update"===a.reason?(u(a.lastVersion),chrome.tabs.create({url:"https://extensions.adaware.com/securesearch/update.html"})):"startup"===a.reason&&(vAPI.storage.get({installDate:Date.now()},function(a){adawareTelemetry.setInstallDate(a.installDate)}),vAPI.storage.get({installId:adawareUtils.generateUUID()},function(a){adawareTelemetry.setInstallId(a.installId)}),vAPI.storage.get({startupTime:Date.now()},function(a){Date.now()-a.startupTime>t&&i(a.startupTime,localStorage.getItem("Background")),vAPI.storage.set({startupTime:Date.now()})}),s(e.NUM_TO_SEARCH_MAP[e.webCompanionData.searchEngine]))})},p=function(e){e.version!==vAPI.app.version&&vAPI.storage.set({version:vAPI.app.version}),a=Date.now(),setInterval(function(){i(a,localStorage.getItem("Background")),a=Date.now()},t)};return function(){vAPI.capturePreOpenedTabUrls(),vAPI.onLoadAllCompleted(),vAPI.onExtensionLaunch(D);vAPI.storage.get({version:"0.0.0.0"},p)}}(),uBlock.restart(),chrome.runtime.onMessage.addListener(function(a,e,t){if("changeTheme"==a.contents){(new Date).toISOString(),a.theme;t({farewell:"goodbye"})}else if("contentUrls"==a.contents){var n=JSON.parse(localStorage.getItem("ACS_black")),r={validUrls:{},unvalidUrls:{}};for(var o in a.urls)n.indexOf(a.urls[o])>-1?r.unvalidUrls[o]=a.urls[o]:r.validUrls[o]=a.urls[o];t({urls:r})}});